# Forms Architecture Diagram

Visual reference for understanding the complete form flow in this React Server Components application.

## Complete Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERACTION                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. SERVER COMPONENT (route.tsx)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  export default async function Page() {                          â”‚  â”‚
â”‚  â”‚    const logger = getLogger();                                   â”‚  â”‚
â”‚  â”‚    logger.info("Loading page");                                  â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚    // Fetch data in parallel                                     â”‚  â”‚
â”‚  â”‚    const [employees, stations] = await Promise.all([             â”‚  â”‚
â”‚  â”‚      db.employee.findMany(),                                     â”‚  â”‚
â”‚  â”‚      db.station.findMany(),                                      â”‚  â”‚
â”‚  â”‚    ]);                                                            â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚    return <ClientShell data={...} />;                            â”‚  â”‚
â”‚  â”‚  }                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  âœ“ Async function                                                       â”‚
â”‚  âœ“ Direct database access (Prisma)                                      â”‚
â”‚  âœ“ Request-scoped logging                                               â”‚
â”‚  âœ“ Zero client JavaScript                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. CLIENT SHELL (client.tsx)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  "use client";                                                    â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  export function ClientShell({ employees, stations }) {          â”‚  â”‚
â”‚  â”‚    // Server action state                                        â”‚  â”‚
â”‚  â”‚    const [state, action, isPending] = useActionState(            â”‚  â”‚
â”‚  â”‚      serverAction,                                               â”‚  â”‚
â”‚  â”‚      null                                                         â”‚  â”‚
â”‚  â”‚    );                                                             â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚    // Optimistic updates                                         â”‚  â”‚
â”‚  â”‚    const [optimisticData, addOptimistic] = useOptimistic(        â”‚  â”‚
â”‚  â”‚      state?.data ?? initialData,                                 â”‚  â”‚
â”‚  â”‚      (current, update) => [update, ...current]                   â”‚  â”‚
â”‚  â”‚    );                                                             â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚    return (                                                       â”‚  â”‚
â”‚  â”‚      <>                                                           â”‚  â”‚
â”‚  â”‚        {optimisticData.map(...)}                                 â”‚  â”‚
â”‚  â”‚        <FormComponent                                            â”‚  â”‚
â”‚  â”‚          onSubmit={action}                                       â”‚  â”‚
â”‚  â”‚          onOptimistic={addOptimistic}                            â”‚  â”‚
â”‚  â”‚          isPending={isPending}                                   â”‚  â”‚
â”‚  â”‚          state={state}                                           â”‚  â”‚
â”‚  â”‚        />                                                         â”‚  â”‚
â”‚  â”‚      </>                                                          â”‚  â”‚
â”‚  â”‚    );                                                             â”‚  â”‚
â”‚  â”‚  }                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  âœ“ "use client" directive                                               â”‚
â”‚  âœ“ useActionState hook                                                  â”‚
â”‚  âœ“ useOptimistic for instant UI updates                                 â”‚
â”‚  âœ“ Manages form state                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. FORM COMPONENT (form.tsx)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  "use client";                                                    â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  export function MyForm({ onSubmit, onOptimistic, state }) {     â”‚  â”‚
â”‚  â”‚    const [formData, setFormData] = useState({});                 â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚    const handleSubmit = () => {                                  â”‚  â”‚
â”‚  â”‚      const fd = new FormData();                                  â”‚  â”‚
â”‚  â”‚      fd.append("name", formData.name);                           â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚      // Optimistic update (instant UI feedback)                  â”‚  â”‚
â”‚  â”‚      onOptimistic?.(formData);                                   â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚      // Server action (async mutation)                           â”‚  â”‚
â”‚  â”‚      onSubmit(fd);                                               â”‚  â”‚
â”‚  â”‚    };                                                             â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚    return (                                                       â”‚  â”‚
â”‚  â”‚      <Form onSubmit={handleSubmit}>                              â”‚  â”‚
â”‚  â”‚        <Input ... />                                             â”‚  â”‚
â”‚  â”‚        {state?.error && <Alert>{state.error}</Alert>}            â”‚  â”‚
â”‚  â”‚        <Button type="submit" disabled={isPending}>               â”‚  â”‚
â”‚  â”‚          Submit                                                   â”‚  â”‚
â”‚  â”‚        </Button>                                                  â”‚  â”‚
â”‚  â”‚      </Form>                                                      â”‚  â”‚
â”‚  â”‚    );                                                             â”‚  â”‚
â”‚  â”‚  }                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  âœ“ "use client" directive                                               â”‚
â”‚  âœ“ Controlled inputs (useState)                                         â”‚
â”‚  âœ“ Design System components                                             â”‚
â”‚  âœ“ Calls callbacks from shell                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â†“ FormData submitted
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. SERVER ACTION (actions.ts)                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  "use server";                                                    â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  export async function createEmployee(                           â”‚  â”‚
â”‚  â”‚    prevState: State | null,                                      â”‚  â”‚
â”‚  â”‚    formData: FormData                                            â”‚  â”‚
â”‚  â”‚  ): Promise<State> {                                             â”‚  â”‚
â”‚  â”‚    const logger = getLogger();                                   â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚    // Extract data                                               â”‚  â”‚
â”‚  â”‚    const name = formData.get("name") as string;                  â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚    logger.info({ name }, "Creating employee");                   â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚    try {                                                          â”‚  â”‚
â”‚  â”‚      // Validate                                                  â”‚  â”‚
â”‚  â”‚      if (!name) {                                                 â”‚  â”‚
â”‚  â”‚        return { error: "Name is required" };                     â”‚  â”‚
â”‚  â”‚      }                                                            â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚      // Database mutation with performance logging               â”‚  â”‚
â”‚  â”‚      const employee = await logPerformance(                      â”‚  â”‚
â”‚  â”‚        "create-employee",                                        â”‚  â”‚
â”‚  â”‚        () => db.employee.create({ data: { name } })             â”‚  â”‚
â”‚  â”‚      );                                                           â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚      logger.info({ id: employee.id }, "Created");                â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚      // Return serializable state                                â”‚  â”‚
â”‚  â”‚      return { success: true, employee };                         â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚    } catch (error) {                                             â”‚  â”‚
â”‚  â”‚      logError(error as Error, {                                  â”‚  â”‚
â”‚  â”‚        operation: "create-employee"                              â”‚  â”‚
â”‚  â”‚      });                                                          â”‚  â”‚
â”‚  â”‚      return { error: "Failed to create" };                       â”‚  â”‚
â”‚  â”‚    }                                                              â”‚  â”‚
â”‚  â”‚  }                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  âœ“ "use server" directive                                               â”‚
â”‚  âœ“ Receives FormData                                                    â”‚
â”‚  âœ“ Database mutations                                                   â”‚
â”‚  âœ“ Request-scoped logging                                               â”‚
â”‚  âœ“ Returns serializable state                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â†“ State returned
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                       â”‚
                        â†“                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  SUCCESS PATH    â”‚    â”‚   ERROR PATH     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚                       â”‚
                        â†“                       â†“
            state.success = true      state.error = "..."
                        â”‚                       â”‚
                        â†“                       â†“
            Optimistic update         Display error alert
            becomes permanent         Roll back optimistic
                        â”‚                       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   UI UPDATED        â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
USER TYPES IN FORM
        â”‚
        â†“
Local State (useState)
        â”‚
        â†“
CLICK SUBMIT
        â”‚
        â”œâ”€â”€â†’ Build FormData
        â”‚
        â”œâ”€â”€â†’ onOptimistic(data)  â”€â”€â”€â”€â”€â†’  UI Updates Instantly âœ¨
        â”‚                                 (Optimistic State)
        â”‚
        â””â”€â”€â†’ onSubmit(FormData)
                â”‚
                â†“
        Server Action Executes
                â”‚
                â”œâ”€â”€â†’ Validate Input
                â”‚
                â”œâ”€â”€â†’ Database Mutation
                â”‚         â”‚
                â”‚         â†“
                â”‚    Prisma ORM
                â”‚         â”‚
                â”‚         â†“
                â”‚    MySQL Database
                â”‚         â”‚
                â”‚         â†“
                â”‚    Log Query (debug level)
                â”‚
                â”œâ”€â”€â†’ Log Performance
                â”‚
                â””â”€â”€â†’ Return State
                        â”‚
                        â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                â”‚
          SUCCESS              ERROR
                â”‚                â”‚
                â†“                â†“
        { success: true,   { error: "..." }
          data: {...} }          â”‚
                â”‚                â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
              useActionState Updates
                         â”‚
                         â†“
              Component Re-renders
                         â”‚
                         â”œâ”€â”€â†’ Display Success Message
                         â”œâ”€â”€â†’ Display Error Alert
                         â”œâ”€â”€â†’ Reset Form
                         â””â”€â”€â†’ Close Modal
```

## Optimistic Updates Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPTIMISTIC UPDATE FLOW                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INITIAL STATE
â”œâ”€ Server Data: [item1, item2, item3]
â””â”€ UI Shows: [item1, item2, item3]

USER SUBMITS FORM
â”œâ”€ addOptimistic({ newItem }) is called FIRST
â”‚  â””â”€ Optimistic State: [newItem, item1, item2, item3]
â”‚     â””â”€ UI Shows: [newItem*, item1, item2, item3]  â† Instant!
â”‚                    â””â”€ * marked as "pending" or "saving"
â”‚
â””â”€ action(formData) is called SECOND
   â””â”€ Network request to server...
      â”‚
      â”œâ”€ SUCCESS CASE
      â”‚  â””â”€ Server returns { success: true, data: [realNewItem, item1, ...] }
      â”‚     â””â”€ Optimistic state replaced with real data
      â”‚        â””â”€ UI Shows: [realNewItem, item1, item2, item3]  â† Confirmed!
      â”‚
      â””â”€ ERROR CASE
         â””â”€ Server returns { error: "..." }
            â””â”€ Optimistic state automatically rolled back
               â””â”€ UI Shows: [item1, item2, item3]  â† Back to before
                  â””â”€ Error alert displayed
```

## Component Communication Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Server Component (RSC)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  async function Page() {                                  â”‚  â”‚
â”‚  â”‚    const data = await db.query();  // Direct DB access   â”‚  â”‚
â”‚  â”‚    return <ClientShell data={data} />;                   â”‚  â”‚
â”‚  â”‚  }                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Props (serializable data)
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client Shell                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  "use client";                                            â”‚  â”‚
â”‚  â”‚  function ClientShell({ data }) {                         â”‚  â”‚
â”‚  â”‚    const [state, action] = useActionState(serverAction);  â”‚  â”‚
â”‚  â”‚    return <Form onSubmit={action} />;                     â”‚  â”‚
â”‚  â”‚  }                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Callback props
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Form Component                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  "use client";                                            â”‚  â”‚
â”‚  â”‚  function Form({ onSubmit }) {                            â”‚  â”‚
â”‚  â”‚    return <form onSubmit={() => onSubmit(formData)} />;  â”‚  â”‚
â”‚  â”‚  }                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ FormData
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Server Action                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  "use server";                                            â”‚  â”‚
â”‚  â”‚  async function serverAction(prev, formData) {            â”‚  â”‚
â”‚  â”‚    await db.mutate();  // Database mutation              â”‚  â”‚
â”‚  â”‚    return { success: true };                             â”‚  â”‚
â”‚  â”‚  }                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure Example

```
src/routes/employees/
â”‚
â”œâ”€â”€ route.tsx                  # Server Component
â”‚   â”œâ”€ export default async function EmployeesPage()
â”‚   â”œâ”€ Fetches employees from database
â”‚   â””â”€ Returns <EmployeesShell employees={employees} />
â”‚
â”œâ”€â”€ client.tsx                 # Client Shell
â”‚   â”œâ”€ "use client"
â”‚   â”œâ”€ useActionState(createEmployee, null)
â”‚   â”œâ”€ useOptimistic for instant updates
â”‚   â””â”€ Returns <EmployeeForm onSubmit={...} />
â”‚
â”œâ”€â”€ form.tsx                   # Form Component
â”‚   â”œâ”€ "use client"
â”‚   â”œâ”€ Controlled inputs with useState
â”‚   â”œâ”€ Design System components (Button, Input, etc.)
â”‚   â””â”€ Calls onSubmit callback
â”‚
â”œâ”€â”€ actions.ts                 # Server Actions
â”‚   â”œâ”€ "use server"
â”‚   â”œâ”€ export async function createEmployee(prev, formData)
â”‚   â”œâ”€ Validates, logs, and mutates database
â”‚   â””â”€ Returns { success: true } or { error: "..." }
â”‚
â””â”€â”€ types.ts                   # TypeScript Types
    â””â”€ Shared type definitions
```

## Logging Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REQUEST STARTS                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” Server Component                                            â”‚
â”‚  logger.info("Loading employees page")                         â”‚
â”‚  logger.debug({ count }, "Employees loaded")                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ (user submits form)
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” Server Action                                               â”‚
â”‚  logger.info({ name }, "Creating employee")                    â”‚
â”‚  â”œâ”€ logPerformance("create-employee", async () => {...})       â”‚
â”‚  â”‚  â””â”€ Automatically logs duration                             â”‚
â”‚  â”œâ”€ logger.info({ id }, "Employee created")  [SUCCESS]         â”‚
â”‚  â””â”€ logError(error, { operation })           [ERROR]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” Database (Automatic)                                        â”‚
â”‚  dbLogger.debug({ query, duration }, "Database query")         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Management Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STATE LAYERS                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: SERVER DATA (Source of Truth)
â”œâ”€ Fetched in Server Component
â”œâ”€ Passed to Client Shell as props
â””â”€ Example: employees, stations, tasks

Layer 2: ACTION STATE (useActionState)
â”œâ”€ Managed by React
â”œâ”€ Updated when server action completes
â”œâ”€ Contains: { success?, error?, data? }
â””â”€ Example: { success: true, employee: {...} }

Layer 3: OPTIMISTIC STATE (useOptimistic)
â”œâ”€ Temporary UI state
â”œâ”€ Updated instantly on form submit
â”œâ”€ Rolled back on error
â””â”€ Example: [optimisticItem, ...serverData]

Layer 4: LOCAL FORM STATE (useState)
â”œâ”€ Controlled inputs
â”œâ”€ Form-specific data
â”œâ”€ Reset on success
â””â”€ Example: { name: "John", email: "..." }
```

## Error Handling Flow

```
SERVER ACTION EXECUTES
        â”‚
        â†“
   Try/Catch Block
        â”‚
        â”œâ”€ VALIDATION ERROR
        â”‚  â””â”€ return { error: "Invalid input" }
        â”‚     â””â”€ Shows in UI as <Alert variant="error">
        â”‚
        â”œâ”€ DATABASE ERROR
        â”‚  â”œâ”€ logError(error, { operation })
        â”‚  â””â”€ return { error: "Failed to save" }
        â”‚     â””â”€ Shows in UI as <Alert variant="error">
        â”‚
        â””â”€ SUCCESS
           â”œâ”€ logger.info({ id }, "Success")
           â””â”€ return { success: true, data: {...} }
              â”œâ”€ Optimistic state confirmed
              â”œâ”€ Shows <Alert variant="success">
              â””â”€ Form resets/closes
```

## Quick Reference

### File Responsibilities

| File         | Directive      | Can Use                            | Cannot Use          |
| ------------ | -------------- | ---------------------------------- | ------------------- |
| `route.tsx`  | None           | DB, async/await, getLogger()       | Hooks, browser APIs |
| `actions.ts` | `"use server"` | DB, async/await, getLogger()       | Hooks, browser APIs |
| `client.tsx` | `"use client"` | Hooks, useActionState, getLogger() | DB, async top-level |
| `form.tsx`   | `"use client"` | Hooks, useState, Input/Button      | DB, async top-level |

### Data Flow Direction

```
Server Component â†’ Client Shell â†’ Form Component
        â†“              â†‘              â†‘
        â”‚              â”‚              â”‚
        â”‚              â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
                Server Action
                (FormData)
```

This architecture provides:

- âœ… Type safety throughout
- âœ… Optimal performance (minimal client JS)
- âœ… Great UX (optimistic updates)
- âœ… Comprehensive logging
- âœ… Clear separation of concerns
